<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>게임 계산기</title>
<style>
body{font-family:sans-serif;background:#f6f7fb;padding:16px;}
.wrap{max-width:700px;margin:auto;}
h1{font-size:22px;margin-bottom:6px;}
.item{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:12px;margin-bottom:8px;border-radius:12px;border:1px solid #e6e9ef;}
.left{display:flex;flex-direction:column;}
.label{font-weight:600;}
.controls{display:flex;align-items:center;gap:4px;flex-wrap:wrap;}
input.num{width:50px;text-align:center;border-radius:6px;border:1px solid #d1d5db;padding:4px;}
button{padding:6px 10px;border-radius:8px;border:none;cursor:pointer;}
button.btn{background:#111827;color:#fff;}
button.qtyBtn{background:#e0e7ff;color:#111827;}
button.qtyBtn.active{background:#3b82f6;color:#fff;}
.summary{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:12px;border-radius:12px;border:1px solid #e6e9ef;margin-top:12px;}
.receipt{margin-top:10px;background:#fff;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;white-space:pre-line;}
</style>
</head>
<body>
<div class="wrap">
<h1>게임 계산기</h1>
<label>팀 이름: <input type="text" id="teamName" placeholder="팀 이름 입력"></label>

<div class="item">
<span>게임 횟수:</span>
<select id="gameCount">
  <option value="1">1 게임</option>
  <option value="2">2 게임</option>
  <option value="3">3 게임</option>
</select>
</div>

<div class="item">
<label><input type="checkbox" id="promoToggle"> 1+1 행사 적용 (2게임 이상 가능)</label>
</div>

<div class="item">
<label><input type="checkbox" id="deposit1"> 1게임 예약금 5,000원</label>
<label><input type="checkbox" id="deposit2"> 2게임 예약금 5,000원</label>
<label><input type="checkbox" id="deposit3"> 3게임 예약금 5,000원</label>
</div>

<div id="itemsWrap"></div>

<div class="summary">
<div>총 합계: <span id="totalPrice">₩0</span></div>
</div>

<div id="receiptWrap" class="receipt"></div>

<div style="margin-top:8px;">
<label>받은 금액: <input type="number" id="receivedAmount" value="0"></label>
<span>잔돈: ₩<span id="changeAmount">0</span></span>
</div>

<div style="margin-top:12px;">
<button id="clearBtn" class="btn" style="background:#efefef;color:#111827;">전체 초기화</button>
<button id="printBtn" class="btn">영수증 인쇄/저장</button>
<button id="saveImgBtn" class="btn">영수증 이미지 저장</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const ITEMS=[
{id:'adult',label:'성인',price:7000},
{id:'student',label:'학생',price:5000},
{id:'slush',label:'슬러시',price:1500},
{id:'socks',label:'양말',price:1000},
{id:'drink',label:'음료수',price:1000},
];

const itemsWrap=document.getElementById('itemsWrap');
const totalPriceEl=document.getElementById('totalPrice');
const receiptWrap=document.getElementById('receiptWrap');
const teamNameInput=document.getElementById('teamName');
const gameCountSel=document.getElementById('gameCount');
const promoToggle=document.getElementById('promoToggle');
const deposit1=document.getElementById('deposit1');
const deposit2=document.getElementById('deposit2');
const deposit3=document.getElementById('deposit3');
const receivedAmount=document.getElementById('receivedAmount');
const changeAmount=document.getElementById('changeAmount');

let qty={adult:0,student:0,slush:0,socks:0,drink:0};

ITEMS.forEach(it=>{
    const row=document.createElement('div'); row.className='item';
    const left=document.createElement('div'); left.className='left';
    left.innerHTML=`<div class="label">${it.label}</div><div class="price">${it.price.toLocaleString()}원</div>`;
    const controls=document.createElement('div'); controls.className='controls';

    for(let i=1;i<=8;i++){
        const btn=document.createElement('button');
        btn.innerText=i;
        btn.className='qtyBtn';
        btn.onclick=()=>{
            setQty(it.id,i);
            document.getElementById(it.id+'Custom').value='';
            const siblings=controls.querySelectorAll('button.qtyBtn');
            siblings.forEach(s=>s.classList.remove('active'));
            btn.classList.add('active');
        }
        controls.appendChild(btn);
    }

    const customInp=document.createElement('input');
    customInp.type='number'; customInp.min=0; customInp.placeholder='직접입력';
    customInp.id=it.id+'Custom';
    customInp.oninput=()=>{
        setQty(it.id, parseInt(customInp.value)||0);
        const siblings=controls.querySelectorAll('button.qtyBtn');
        siblings.forEach(s=>s.classList.remove('active'));
    }
    controls.appendChild(customInp);

    row.appendChild(left); row.appendChild(controls);
    itemsWrap.appendChild(row);
});

function setQty(id,val){qty[id]=Math.max(0,val); updateSummary();}

function applyPromotion(adultCount, studentCount){
    let adultPaid=Math.floor(adultCount/2), studentPaid=Math.floor(studentCount/2);
    let adultRemain=adultCount%2, studentRemain=studentCount%2;
    if(adultRemain && studentRemain){ adultPaid+=1; adultRemain=0; studentRemain=0; }
    adultPaid+=adultRemain; studentPaid+=studentRemain;
    return {adultPaid, studentPaid};
}

function updateSummary(){
    let gameCount=Number(gameCountSel.value);
    promoToggle.disabled=gameCount<2;
    if(gameCount<2) promoToggle.checked=false;

    // 게임별 예약금 체크
    const depositArr=[deposit1.checked,deposit2.checked,deposit3.checked];

    let receipt='';
    let total=0;
    let now = new Date();
    let timeStr = now.toLocaleString();
    receipt += `팀: ${teamNameInput.value || '없음'}\n발행 시간: ${timeStr}\n------------------------------\n`;

    for(let g=1; g<=gameCount; g++){
        let gameAdult = qty.adult;
        let gameStudent = qty.student;
        let gameSlush = g===1 ? qty.slush : 0;
        let gameSocks = g===1 ? qty.socks : 0;
        let gameDrink = g===1 ? qty.drink : 0;
        let gameTotal=0;
        let dep=depositArr[g-1]?5000:0;

        // 1+1 행사 적용
        let paidAdult=gameAdult, paidStudent=gameStudent;
        if(promoToggle.checked && g>=2){
            const promo=applyPromotion(gameAdult,gameStudent);
            paidAdult=promo.adultPaid;
            paidStudent=promo.studentPaid;
        }

        gameTotal = paidAdult*7000 + paidStudent*5000 + gameSlush*1500 + gameSocks*1000 + gameDrink*1000 - dep;
        total += gameTotal;

        receipt += `게임${g}${(promoToggle.checked && g>=2)?' (1+1 행사 적용)':''}\n`;
        receipt += `성인 ${gameAdult}명 → ${paidAdult}명 요금 = ₩${(paidAdult*7000).toLocaleString()}\n`;
        receipt += `학생 ${gameStudent}명 → ${paidStudent}명 요금 = ₩${(paidStudent*5000).toLocaleString()}\n`;
        if(g===1){
            receipt += `슬러시 ${gameSlush}개 x 1,500원 = ₩${(gameSlush*1500).toLocaleString()}\n`;
            receipt += `양말 ${gameSocks}개 x 1,000원 = ₩${(gameSocks*1000).toLocaleString()}\n`;
            receipt += `음료 ${gameDrink}개 x 1,000원 = ₩${(gameDrink*1000).toLocaleString()}\n`;
        }
        if(dep>0) receipt += `예약금 차감 -₩${dep.toLocaleString()}\n`;
        receipt += `합계: ₩${gameTotal.toLocaleString()}\n------------------------------\n`;
    }

    receipt += `총 금액: ₩${total.toLocaleString()}\n`;
    receiptWrap.innerText=receipt;

    totalPriceEl.innerHTML='<b>₩'+total.toLocaleString()+'</b>';

    const received = Number(receivedAmount.value) || 0;
    const change = received - total;
    changeAmount.innerText = change>=0 ? change.toLocaleString() : 0;
}

gameCountSel.onchange=updateSummary;
promoToggle.onchange=updateSummary;
deposit1.onchange=updateSummary;
deposit2.onchange=updateSummary;
deposit3.onchange=updateSummary;
receivedAmount.oninput=updateSummary;

document.getElementById('clearBtn').onclick=()=>{
    qty={adult:0,student:0,slush:0,socks:0,drink:0};
    document.querySelectorAll('input.num, input[type=number]').forEach(inp => inp.value = '');
    document.querySelectorAll('button.qtyBtn').forEach(b=>b.classList.remove('active'));
    gameCountSel.value='1';
    promoToggle.checked=false;
    deposit1.checked=false;
    deposit2.checked=false;
    deposit3.checked=false;
    receivedAmount.value=0;
    updateSummary();
};

document.getElementById('printBtn').onclick=()=>{window.print();};

document.getElementById('saveImgBtn').onclick=()=>{
    html2canvas(receiptWrap).then(canvas=>{
        const link=document.createElement('a');
        link.download='receipt.png';
        link.href=canvas.toDataURL();
        link.click();
    });
};

updateSummary();
</script>
</body>
</html>
