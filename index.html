<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>게임 계산기</title>
<style>
body{font-family:sans-serif;background:#f6f7fb;padding:16px;}
.wrap{max-width:700px;margin:auto;}
h1{font-size:22px;margin-bottom:6px;}
.item{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:12px;margin-bottom:8px;border-radius:12px;border:1px solid #e6e9ef;}
.left{display:flex;flex-direction:column;}
.label{font-weight:600;}
.price{font-size:13px;color:#6b7280;}
.controls{display:flex;align-items:center;gap:6px;}
input.num{width:50px;text-align:center;border-radius:6px;border:1px solid #d1d5db;padding:4px;}
button{padding:6px 10px;border-radius:8px;border:none;cursor:pointer;}
button.btn{background:#111827;color:#fff;}
.summary{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:12px;border-radius:12px;border:1px solid #e6e9ef;margin-top:12px;}
.receipt{margin-top:10px;background:#fff;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;white-space:pre-line;}
</style>
</head>
<body>
<div class="wrap">
<h1>게임 계산기</h1>
<label>팀 이름: <input type="text" id="teamName" placeholder="팀 이름 입력"></label>

<div class="item">
<span>게임 횟수:</span>
<select id="gameCount">
  <option value="1">1 게임</option>
  <option value="2">2 게임</option>
  <option value="3">3 게임</option>
</select>
</div>

<div class="item">
<label><input type="checkbox" id="promoToggle"> 1+1 행사 적용 (2게임 이상 가능)</label>
</div>

<div class="item">
<label><input type="checkbox" id="deposit1"> 1게임 예약금 5,000원</label>
<label><input type="checkbox" id="deposit2"> 2게임 예약금 5,000원</label>
<label><input type="checkbox" id="deposit3"> 3게임 예약금 5,000원</label>
</div>

<div id="itemsWrap"></div>

<div class="summary">
<div>총 합계: <span id="totalPrice">₩0</span></div>
</div>

<div id="receiptWrap" class="receipt"></div>

<div style="margin-top:8px;">
<label>받은 금액: <input type="number" id="receivedAmount" value="0"></label>
<span>잔돈: ₩<span id="changeAmount">0</span></span>
</div>

<div style="margin-top:12px;">
<button id="clearBtn" class="btn" style="background:#efefef;color:#111827;">전체 초기화</button>
<button id="printBtn" class="btn">영수증 인쇄/저장</button>
<button id="saveImgBtn" class="btn">영수증 이미지 저장</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const ITEMS=[
{id:'adult',label:'성인',price:7000},
{id:'student',label:'학생',price:5000},
{id:'slush',label:'슬러시',price:1500},
{id:'socks',label:'양말',price:1000},
{id:'drink',label:'음료수',price:1000},
];

const itemsWrap=document.getElementById('itemsWrap');
const totalPriceEl=document.getElementById('totalPrice');
const receiptWrap=document.getElementById('receiptWrap');
const teamNameInput=document.getElementById('teamName');
const gameCountSel=document.getElementById('gameCount');
const promoToggle=document.getElementById('promoToggle');
const deposit1=document.getElementById('deposit1');
const deposit2=document.getElementById('deposit2');
const deposit3=document.getElementById('deposit3');
const receivedAmount=document.getElementById('receivedAmount');
const changeAmount=document.getElementById('changeAmount');

let qty={adult:0,student:0,slush:0,socks:0,drink:0};

ITEMS.forEach(it=>{
    const row=document.createElement('div'); row.className='item';
    const left=document.createElement('div'); left.className='left';
    left.innerHTML=`<div class="label">${it.label}</div><div class="price">${it.price.toLocaleString()}원</div>`;
    const controls=document.createElement('div'); controls.className='controls';
    const dec=document.createElement('button'); dec.innerText='−';
    const inp=document.createElement('input'); inp.type='number'; inp.className='num'; inp.value=0;
    const inc=document.createElement('button'); inc.innerText='+';
    controls.appendChild(dec); controls.appendChild(inp); controls.appendChild(inc);
    row.appendChild(left); row.appendChild(controls);
    itemsWrap.appendChild(row);
    dec.onclick=()=>{setQty(it.id,qty[it.id]-1); inp.value=qty[it.id];}
    inc.onclick=()=>{setQty(it.id,qty[it.id]+1); inp.value=qty[it.id];}
    inp.oninput=()=>{setQty(it.id,parseInt(inp.value)||0);}
});

function setQty(id,val){qty[id]=Math.max(0,val); updateSummary();}

function applyPromotion(adultCount, studentCount){
    let adultPaid=Math.floor(adultCount/2), studentPaid=Math.floor(studentCount/2);
    let adultRemain=adultCount%2, studentRemain=studentCount%2;
    if(adultRemain && studentRemain){ adultPaid+=1; adultRemain=0; studentRemain=0; }
    adultPaid+=adultRemain; studentPaid+=studentRemain;
    return {adultPaid, studentPaid};
}

function updateSummary(){
    let gameCount=Number(gameCountSel.value);
    promoToggle.disabled=gameCount<2;
    if(gameCount<2) promoToggle.checked=false;

    // 예약금 계산
    let depositTotal=0;
    if(deposit1.checked) depositTotal+=5000;
    if(deposit2.checked && gameCount>=2) depositTotal+=5000;
    if(deposit3.checked && gameCount>=3) depositTotal+=5000;

    // 1게임 금액
    let game1AdultPrice = qty.adult*7000;
    let game1StudentPrice = qty.student*5000;
    let game1SlushPrice = qty.slush*1500;
    let game1SocksPrice = qty.socks*1000;
    let game1DrinkPrice = qty.drink*1000;
    let game1Total = game1AdultPrice + game1StudentPrice + game1SlushPrice + game1SocksPrice + game1DrinkPrice;
    if(deposit1.checked) game1Total -=5000;

    // 2게임 이상 금액
    let game2Total=0;
    if(gameCount>1){
        let totalAdult = qty.adult*(gameCount-1);
        let totalStudent = qty.student*(gameCount-1);
        let paidAdult=totalAdult, paidStudent=totalStudent;
        if(promoToggle.checked){
            const promo=applyPromotion(totalAdult,totalStudent);
            paidAdult = promo.adultPaid;
            paidStudent = promo.studentPaid;
        }
        game2Total = paidAdult*7000 + paidStudent*5000;
        if(deposit2.checked) game2Total -=5000;
        if(deposit3.checked && gameCount>=3) game2Total -=5000;
    }

    let total=game1Total + game2Total;
    totalPriceEl.innerHTML='<b>₩'+total.toLocaleString()+'</b>';

    // 영수증 생성
    let now = new Date();
    let timeStr = now.toLocaleString();
    let receipt = `팀: ${teamNameInput.value || '없음'}\n`;
    receipt += `발행 시간: ${timeStr}\n------------------------------\n`;
    receipt += `게임1\n`;
    receipt += `성인 ${qty.adult}명 x 7,000원 = ₩${game1AdultPrice.toLocaleString()}\n`;
    receipt += `학생 ${qty.student}명 x 5,000원 = ₩${game1StudentPrice.toLocaleString()}\n`;
    receipt += `슬러시 ${qty.slush}개 x 1,500원 = ₩${game1SlushPrice.toLocaleString()}\n`;
    receipt += `양말 ${qty.socks}개 x 1,000원 = ₩${game1SocksPrice.toLocaleString()}\n`;
    receipt += `음료 ${qty.drink}개 x 1,000원 = ₩${game1DrinkPrice.toLocaleString()}\n`;
    if(deposit1.checked) receipt += `예약금 차감 -₩5,000\n`;
    receipt += `합계: ₩${game1Total.toLocaleString()}\n------------------------------\n`;

    if(gameCount>1){
        receipt += `${gameCount-1}게임${promoToggle.checked?' (1+1 행사 적용)':''}\n`;
        let totalAdult = qty.adult*(gameCount-1);
        let totalStudent = qty.student*(gameCount-1);
        let paidAdult=totalAdult, paidStudent=totalStudent;
        if(promoToggle.checked){
            const promo=applyPromotion(totalAdult,totalStudent);
            paidAdult = promo.adultPaid;
            paidStudent = promo.studentPaid;
        }
        receipt += `성인 ${totalAdult}명 → ${paidAdult}명 요금 = ₩${(paidAdult*7000).toLocaleString()}\n`;
        receipt += `학생 ${totalStudent}명 → ${paidStudent}명 요금 = ₩${(paidStudent*5000).toLocaleString()}\n`;
        if(deposit2.checked) receipt += `예약금 차감 -₩5,000\n`;
        if(deposit3.checked && gameCount>=3) receipt += `예약금 차감 -₩5,000\n`;
        receipt += `합계: ₩${game2Total.toLocaleString()}\n------------------------------\n`;
    }

    receipt += `총 금액: ₩${total.toLocaleString()}\n`;
    receiptWrap.innerText = receipt;

    // 잔돈 계산
    const received = Number(receivedAmount.value) || 0;
    const change = received - total;
    changeAmount.innerText = change>=0 ? change.toLocaleString() : 0;
}

gameCountSel.onchange=updateSummary;
promoToggle.onchange=updateSummary;
deposit1.onchange=updateSummary;
deposit2.onchange=updateSummary;
deposit3.onchange=updateSummary;
receivedAmount.oninput=updateSummary;

document.getElementById('clearBtn').onclick=()=>{
    qty={adult:0,student:0,slush:0,socks:0,drink:0};
    document.querySelectorAll('input.num').forEach(inp => inp.value = 0);
    gameCountSel.value='1';
    promoToggle.checked=false;
    deposit1.checked=false;
    deposit2.checked=false;
    deposit3.checked=false;
    receivedAmount.value=0;
    updateSummary();
};

document.getElementById('printBtn').onclick=()=>{window.print();};

document.getElementById('saveImgBtn').onclick=()=>{
    html2canvas(receiptWrap).then(canvas=>{
        const link=document.createElement('a');
        link.download='receipt.png';
        link.href=canvas.toDataURL();
        link.click();
    });
};

updateSummary();
</script>
</div>
</body>
</html>
